<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-store, max-age=0">
  <title>NAVI-SIMS ‚Äì Dashboard</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Oswald:wght@700&display=swap');

    :root {
      --bg: #F6F7FB; --card: #ffffff; --panel: #F9FAFB; --text: #0F172A;
      --muted: #64748B; --border: #E5E7EB; --ring: #2563EB; --primary: #2563EB;
      --success: #10B981; --warning: #F59E0B;
      --radius: 18px; --shadow: 0 10px 30px rgba(2, 6, 23, .08);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0B1220; --card: #0F172A; --panel: #111827; --text: #E5E7EB;
        --muted: #94A3B8; --border: #1F2937; --primary: #60A5FA;
        --shadow: 0 10px 30px rgba(0, 0, 0, .45);
      }
    }

    * { box-sizing: border-box; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      min-height: 100vh; display: flex; align-items: center; justify-content: center;
      font: 400 16px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    .wrap { width: min(96vw, 1200px); }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; box-shadow: var(--shadow); }
    .top { display: flex; align-items: center; gap: 18px; margin-bottom: 12px; }
    .logo { width: 52px; height: 52px; border-radius: 999px; object-fit: cover; background: #fff; box-shadow: 0 0 0 2px var(--border); }
    h2 { margin: 0 0 4px 0; font-size: 1.5rem; }
    .user-info { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .pill { display: inline-block; margin-right: 8px; padding: 6px 12px; border: 1px solid var(--border); border-radius: 999px; font-size: .82rem; color: var(--muted); background: var(--panel); }
    .security-status { display: flex; gap: 8px; align-items: center; margin-top: 8px; }
    .status-indicator { width: 8px; height: 8px; border-radius: 50%; }
    .status-indicator.secure { background: var(--success); }
    .status-indicator.warning { background: var(--warning); }
    .security-text { font-size: .8rem; color: var(--muted); }

    .modules { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 18px; margin-top: 20px; }
    .module { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 20px; transition: all .2s ease; }
    .module:hover { box-shadow: 0 8px 25px rgba(2, 6, 23, .12); transform: translateY(-2px); }
    .module h3 { margin: 0 0 10px; font-size: 1.08rem; color: var(--text); }
    .module p { margin: 0 0 16px; font-size: .9rem; color: var(--muted); line-height: 1.5; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .btn-outline {
      background: transparent; border: 1px solid var(--primary); color: var(--primary);
      padding: 10px 14px; border-radius: 12px; cursor: pointer; transition: all .15s ease;
      text-decoration: none; display: inline-block; font-size: .9rem; font-weight: 500;
    }
    .btn-outline:hover { background: color-mix(in oklab, var(--primary) 8%, transparent); transform: translateY(-1px); }

    .user-actions { display: flex; gap: 12px; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); }
    .btn { background: var(--primary); color: #fff; border: none; border-radius: 12px; padding: 10px 16px; cursor: pointer; font-weight: 600; transition: all .15s ease; }
    .btn:hover { filter: brightness(1.05); transform: translateY(-1px); }
    .btn.secondary { background: #6B7280; }
    .btn.danger { background: #EF4444; }

    .quick-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 16px 0; }
    .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center; }
    .stat-number { font-size: 1.8rem; font-weight: 700; color: var(--primary); }
    .stat-label { font-size: .85rem; color: var(--muted); margin-top: 4px; }

    .banner-container {
      width: 100%; text-align: center; padding: 2rem 1rem;
      background-color: #ffffff; border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      margin-bottom: 2rem;
    }
    .banner-heading {
      font-family: "Arial Unicode MS", Arial, sans-serif;
      font-weight: 700; font-size: clamp(3rem, 12vw, 6rem);
      letter-spacing: 0.65vw; margin: 0; margin-bottom: -1rem; padding: 0;
    }
    .banner-heading .part-one { color: #231F20; }
    .banner-heading .part-two { color: #965A37; }
    .banner-subheading {
      font-family: 'Montserrat', sans-serif; text-transform: uppercase;
      color: #231F20; letter-spacing: 5px; margin-top: 0; font-weight: 500;
      font-size: clamp(0.6rem, 2.5vw, 0.9rem);
    }

    @media (max-width: 768px) {
      .top { flex-direction: column; align-items: flex-start; gap: 12px; }
      .user-actions { flex-direction: column; }
      .modules { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="banner-container">
      <h1 class="banner-heading">
        <span class="part-one">NAVI</span><span class="part-two">LANTERN</span>
      </h1>
      <p class="banner-subheading">
        NAVAL ARCHITECTURE . MARINE SURVEY . MARINE ENGINEERING
      </p>
    </div>

    <div class="card">
      <div class="top">
        <img class="logo" id="userLogo" src="" alt="Logo" onerror="this.style.display='none'">
        <div style="flex:1">
          <h2 id="welcomeText">Welcome</h2>
          <div class="user-info">
            <div class="pill">Level: <span id="userLevel">‚Äî</span></div>
            <div class="pill">Group: <span id="userGroup">‚Äî</span></div>
            <div class="pill">ID: <span id="userId">‚Äî</span></div>
          </div>
          <div class="security-status">
            <div class="status-indicator secure" id="securityIndicator"></div>
            <div class="security-text" id="securityText">Secure session active</div>
          </div>
        </div>
      </div>

      <div class="quick-stats" id="quickStats" style="display:none">
        <div class="stat-card">
          <div class="stat-number" id="totalUsers">-</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalVessels">-</div>
          <div class="stat-label">Registered Vessels</div>
        </div>
      </div>

      <div id="modulesContainer"></div>

      <div class="user-actions">
        <button id="btnChangePassword" class="btn secondary">Change Password</button>
        <button id="btnSecurity" class="btn secondary">Security Info</button>
        <div style="flex:1"></div>
        <button id="btnLogout" class="btn danger">Secure Logout</button>
      </div>
    </div>
  </div>

  <script src="../assets/js/bridge.js"></script>
  <script>
  (async () => {
    const session = await Bridge.requireAuth({
      logoSel:  'img.app-logo',
      nameSel:  '.js-user-name',
      levelSel: '.js-user-level',
      groupSel: '.js-user-group',
      idSel:    '.js-user-id'
    });
    if (!session) return; // redirected

    // safe to render cards here
    // await Bridge.api.vessels.list() ...
  })();
  </script>
  <script>
    (async function() {
      const user = await NAVI.Guards.requireAuth();
      if (!user) return;

      const session = await NAVI.API.auth.getSession();
      if (!session?.ok) {
        window.location.href = '../index.html';
        return;
      }

      // Populate user info
      document.getElementById('welcomeText').textContent = `Welcome, ${user.username}`;
      document.getElementById('userLevel').textContent = user.levelName || '‚Äî';
      document.getElementById('userGroup').textContent = user.groupName || '‚Äî';
      document.getElementById('userId').textContent = user.userId || '‚Äî';
      
      if (session.logoUrl) {
        document.getElementById('userLogo').src = session.logoUrl;
      }

      // Navigation
      function navigate(page) {
        window.location.href = `./${page}.html`;
      }

      // Logout
      document.getElementById('btnLogout').addEventListener('click', () => {
        if (confirm('Are you sure you want to logout?')) {
          NAVI.API.auth.logout();
        }
      });

      // Render modules based on user level
      const levelId = parseInt(user.levelId) || 999;
      const groupId = String(user.groupId || '').trim();
      const modulesHtml = [];

      if (levelId <= 1) { // Super/Admin
        modulesHtml.push(`
          <div class="module">
            <h3>üë• User Management</h3>
            <p>Create, edit, and manage user accounts.</p>
            <div class="row">
              <button class="btn-outline" onclick="navigate('create_user')">Create User</button>
              <button class="btn-outline" onclick="navigate('edit_user')">Edit Users</button>
            </div>
          </div>
          <div class="module">
            <h3>üè¢ Company Management</h3>
            <p>Register and manage company information.</p>
            <div class="row">
              <button class="btn-outline" onclick="navigate('register_client')">Register Company</button>
              <button class="btn-outline" onclick="navigate('client_list')">Companies List</button>
            </div>
          </div>
          <div class="module">
            <h3>üö¢ Vessel Management</h3>
            <p>Register and manage vessel information.</p>
            <div class="row">
              <button class="btn-outline" onclick="navigate('register_vessel')">Register Vessel</button>
              <button class="btn-outline" onclick="navigate('edit_vessel')">Edit Vessels</button>
              <button class="btn-outline" onclick="navigate('view_vessel')">View Vessel</button>
            </div>
          </div>
        `);
      } else if (levelId === 3) { // Regular user
        modulesHtml.push(`
          <div class="module">
            <h3>üè¢ Companies Details</h3>
            <p>View company information.</p>
            <div class="row">
              <button class="btn-outline" onclick="navigate('client_list')">Companies List</button>
            </div>
          </div>
          <div class="module">
            <h3>üö¢ My Vessels</h3>
            <p>View vessel information.</p>
            <div class="row">
              <button class="btn-outline" onclick="navigate('view_vessel')">View Vessel</button>
              ${groupId === '1' ? '<button class="btn-outline" onclick="navigate(\'edit_vessel\')">Edit Vessel Info</button>' : ''}
            </div>
          </div>
        `);
      }

      document.getElementById('modulesContainer').innerHTML = `<div class="modules">${modulesHtml.join('')}</div>`;
      window.navigate = navigate;

      // Change password
      document.getElementById('btnChangePassword').addEventListener('click', () => navigate('change_password'));

      // Security info (placeholder)
      document.getElementById('btnSecurity').addEventListener('click', () => {
        alert('Security Information:\n\nYour session is encrypted and secure.\nPassword: Protected with industry-standard encryption\nSession: Auto-expires after inactivity');
      });
    })();
  </script>
</body>
</html>